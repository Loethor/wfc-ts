(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA1SURBVChTY/wPBAwEAFgRIyMjlIsJQGbAFb2VUYEKI4DwkztgRUxQPl5AZ0XE+w7KxwEYGABa5h/6Bw62agAAAABJRU5ErkJggg==",M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAYCAYAAAAlBadpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxEAAAsRAX9kX5EAAADkSURBVDhPnZTBEYJADEUDRw/WYgUOnrQDerEjO5ATjhVYhmcOXnGi+5m/2WR1eAdgE37yE2Zoxuc0y0radF+FK+422/Tkg3wh1kRzjQtw3p1ZE7fXlE4lyLu2tXIN5MOFHe6+bY5/xHa+cf+1bAvgjHzLC2DwgoXjrQ4+n6RY0N+2owWhC1zZcZaFcUV+tmNltvXCAQgRi8ZSsk9lhYDHYleLGAIrZGzxrLPClRnPVSZGwhaIXBWdvQKRm0KscAfPLnDFoCZUQjEEkVCpdv5FM5z78O953F1kePTpVFLtXBOKiLwB2Hltqu/4//UAAAAASUVORK5CYII=";class Y{container;selected=null;selectCallback=null;constructor(t,e){const n=document.getElementById(t);if(!n)throw new Error("Missing container");this.container=n,this.createPreviews(e)}createPreviews(t){t.forEach(e=>{const n=document.createElement("img");n.src=e,n.style.imageRendering="pixelated",n.style.margin="5px",n.style.cursor="pointer",n.onload=()=>{const a=Math.floor(64/n.naturalWidth)||1;n.width=n.naturalWidth*a,n.height=n.naturalHeight*a},n.addEventListener("click",()=>{this.selected=n,this.container.querySelectorAll("img").forEach(i=>i.style.border=""),n.style.border="2px solid red",this.selectCallback&&this.selectCallback(n.src)}),this.container.appendChild(n)})}onSelect(t){this.selectCallback=t}getSelected(){return this.selected?.src||null}}class B{container;canvas;ctx;image=null;highlight=null;constructor(t){const e=document.getElementById(t);if(!e)throw new Error("Missing preview container");this.container=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.imageRendering="pixelated",this.container.innerHTML="",this.container.appendChild(this.canvas)}showImage(t){this.image||(this.image=new Image),this.image.onload=()=>this.draw(),this.image.src=t}setHighlight(t){this.highlight=t,this.draw()}draw(){if(!this.image||!this.ctx)return;const t=this.canvas,e=this.ctx,n=200;t.width=n,t.height=n,e.clearRect(0,0,t.width,t.height),e.imageSmoothingEnabled=!1;const i=this.image.naturalWidth,a=this.image.naturalHeight,s=Math.min(t.width/i,t.height/a),p=i*s,l=a*s,h=(t.width-p)/2,u=(t.height-l)/2;if(e.drawImage(this.image,h,u,p,l),!this.highlight)return;const{x:m,y:A,w:o,h:c}=this.highlight,d=m%i,g=A%a,r=Math.min(o,i-d),x=Math.min(c,a-g);if(e.strokeStyle="blue",e.lineWidth=2,e.strokeRect(h+d*s,u+g*s,r*s,x*s),d+o>i){const w=o-r;e.strokeRect(h,u+g*s,w*s,x*s)}if(g+c>a){const w=c-x;e.strokeRect(h+d*s,u,r*s,w*s)}if(d+o>i&&g+c>a){const w=o-r,y=c-x;e.strokeRect(h,u,w*s,y*s)}}}class P{container;label;constructor(t,e){const n=document.getElementById(t);if(!n)throw new Error("Missing container");this.container=n;const i=document.getElementById(e);if(!i)throw new Error("Missing label");this.label=i}generate(t,e,n,i,a,s){return new Promise(p=>{const l=new Image;l.src=t;const h=[];l.onload=()=>{const u=l.naturalWidth,m=l.naturalHeight,A=document.createElement("canvas");A.width=u,A.height=m;const o=A.getContext("2d");o.drawImage(l,0,0),this.container.innerHTML="";const c=new Set;for(let d=0;d<m;d++)for(let g=0;g<u;g++){const r=document.createElement("canvas");r.width=e,r.height=e;const x=r.getContext("2d");for(let f=0;f<e;f++)for(let b=0;b<e;b++){const R=(g+b)%u,j=(d+f)%m,L=o.getImageData(R,j,1,1);x.putImageData(L,b,f)}const w=x.getImageData(0,0,e,e);let y="";for(let f=0;f<w.data.length;f+=4)y+=`${w.data[f]},${w.data[f+1]},${w.data[f+2]},${w.data[f+3]};`;if(c.has(y))continue;c.add(y);const C=document.createElement("div"),S=document.createElement("span");S.textContent=`${h.length}`;const v=document.createElement("canvas");v.width=e*16,v.height=e*16;const I=v.getContext("2d");I.imageSmoothingEnabled=!1,I.drawImage(r,0,0,v.width,v.height),v.style.imageRendering="pixelated",v.style.border="1px solid #ccc",C.appendChild(S),C.appendChild(v),this.container.appendChild(C),h.push(r);const k=h.length-1,T=g,D=d;(f=>{v.addEventListener("mouseenter",()=>{console.log("Mouse entered tile:",f),n({x:T,y:D,w:e,h:e}),a&&a(f,r)}),v.addEventListener("mouseleave",()=>{console.log("Mouse left tile"),i(),s&&s()})})(k)}this.label.textContent=`Tiles: ${h.length}`,p(h)}})}}class H{tiles;neighbors;constructor(t){this.tiles=t,this.neighbors=this.computeNeighbors()}computeNeighbors(){const t=new Map;if(!this.tiles.length)return t;const e=this.tiles[0].pixelData.width;return this.tiles.forEach(n=>{const i=new Set,a=new Set,s=new Set,p=new Set;this.tiles.forEach(l=>{if(n.id===l.id)return;let h=!0;for(let o=0;o<e&&h;o++)for(let c=1;c<e;c++){const d=(o*e+c)*4,g=(o*e+(c-1))*4;for(let r=0;r<4;r++)if(n.pixelData.data[d+r]!==l.pixelData.data[g+r]){h=!1;break}if(!h)break}h&&p.add(l.id);let u=!0;for(let o=0;o<e&&u;o++)for(let c=0;c<e-1;c++){const d=(o*e+c)*4,g=(o*e+(c+1))*4;for(let r=0;r<4;r++)if(n.pixelData.data[d+r]!==l.pixelData.data[g+r]){u=!1;break}if(!u)break}u&&s.add(l.id);let m=!0;for(let o=1;o<e&&m;o++)for(let c=0;c<e;c++){const d=(o*e+c)*4,g=((o-1)*e+c)*4;for(let r=0;r<4;r++)if(n.pixelData.data[d+r]!==l.pixelData.data[g+r]){m=!1;break}if(!m)break}m&&a.add(l.id);let A=!0;for(let o=0;o<e-1&&A;o++)for(let c=0;c<e;c++){const d=(o*e+c)*4,g=((o+1)*e+c)*4;for(let r=0;r<4;r++)if(n.pixelData.data[d+r]!==l.pixelData.data[g+r]){A=!1;break}if(!A)break}A&&i.add(l.id)}),t.set(n.id,{up:Array.from(i),down:Array.from(a),left:Array.from(s),right:Array.from(p)})}),t}}class O{sampleList;previewCanvas;tileExtractor;tileSizeInput;generateBtn;currentTileSet=null;currentTiles=[];constructor(t,e,n,i,a,s,p){this.sampleList=new Y(t,p),this.previewCanvas=new B(e),this.tileExtractor=new P(n,i),this.generateBtn=document.getElementById(a),this.tileSizeInput=document.getElementById(s),this.init()}init(){this.sampleList.onSelect(t=>this.previewCanvas.showImage(t)),this.generateBtn.addEventListener("click",()=>{this.generateTiles()})}async generateTiles(){const t=this.sampleList.getSelected();if(!t)return;const e=parseInt(this.tileSizeInput.value),i=(await this.tileExtractor.generate(t,e,this.previewCanvas.setHighlight.bind(this.previewCanvas),()=>this.previewCanvas.setHighlight(null),(s,p)=>{console.log("Tile hover callback fired:",s),this.showTileAdjacencies(s)},()=>{console.log("Tile leave callback fired"),this.clearAdjacencies()})).map((s,p)=>({id:p,canvas:s,pixelData:s.getContext("2d").getImageData(0,0,e,e)})),a=new H(i);this.currentTileSet=a,this.currentTiles=i,console.log("TileSet created:",a),console.log("Total tiles:",i.length),console.log("Neighbors map:",a.neighbors)}showTileAdjacencies(t){if(console.log("showTileAdjacencies called with index:",t),console.log("currentTileSet:",this.currentTileSet),console.log("currentTiles length:",this.currentTiles.length),!this.currentTileSet||!this.currentTiles[t]){console.warn("TileSet or tile not found");return}const e=this.currentTileSet.neighbors.get(t);if(console.log("Adjacencies for tile",t,":",e),!e){console.warn("No adjacencies found for tile",t);return}const n=document.getElementById("adjacency-viewer");if(console.log("adjacency-viewer element:",n),!n){console.error("adjacency-viewer element not found!");return}n.innerHTML="<h3>Adjacencies:</h3>",["up","down","left","right"].forEach(i=>{const a=document.createElement("div");a.innerHTML=`<strong>${i.toUpperCase()}:</strong>`;const s=document.createElement("div");s.style.display="flex",s.style.gap="2px",s.style.flexWrap="wrap";const p=e[i];console.log(`${i} adjacencies:`,p),p.forEach(l=>{const h=this.currentTiles[l];if(h){const m=document.createElement("canvas");m.width=48,m.height=48;const A=m.getContext("2d");A.imageSmoothingEnabled=!1,A.drawImage(h.canvas,0,0,48,48),m.style.imageRendering="pixelated",m.style.border="1px solid #999",s.appendChild(m)}}),a.appendChild(s),n.appendChild(a)})}clearAdjacencies(){const t=document.getElementById("adjacency-viewer");t&&(t.innerHTML="")}}const Q=Object.assign({"/samples/City.png":U,"/samples/Flowers.png":M}),W=Object.values(Q);new O("sample-selector","sample-preview","generated-tiles","tiles-count","generate-tiles","tile-size",W);
