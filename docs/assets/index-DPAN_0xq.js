(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA1SURBVChTY/wPBAwEAFgRIyMjlIsJQGbAFb2VUYEKI4DwkztgRUxQPl5AZ0XE+w7KxwEYGABa5h/6Bw62agAAAABJRU5ErkJggg==",P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAYCAYAAAAlBadpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxEAAAsRAX9kX5EAAADkSURBVDhPnZTBEYJADEUDRw/WYgUOnrQDerEjO5ATjhVYhmcOXnGi+5m/2WR1eAdgE37yE2Zoxuc0y0radF+FK+422/Tkg3wh1kRzjQtw3p1ZE7fXlE4lyLu2tXIN5MOFHe6+bY5/xHa+cf+1bAvgjHzLC2DwgoXjrQ4+n6RY0N+2owWhC1zZcZaFcUV+tmNltvXCAQgRi8ZSsk9lhYDHYleLGAIrZGzxrLPClRnPVSZGwhaIXBWdvQKRm0KscAfPLnDFoCZUQjEEkVCpdv5FM5z78O953F1kePTpVFLtXBOKiLwB2Hltqu/4//UAAAAASUVORK5CYII=";class S{container;selected=null;selectCallback=null;constructor(e,t){const a=document.getElementById(e);if(!a)throw new Error("Missing container");this.container=a,this.createPreviews(t)}createPreviews(e){e.forEach(t=>{const a=document.createElement("img");a.src=t,a.style.imageRendering="pixelated",a.style.margin="5px",a.style.cursor="pointer",a.onload=()=>{const n=Math.floor(64/a.naturalWidth)||1;a.width=a.naturalWidth*n,a.height=a.naturalHeight*n},a.addEventListener("click",()=>{this.selected=a,this.container.querySelectorAll("img").forEach(i=>i.style.border=""),a.style.border="2px solid red",this.selectCallback&&this.selectCallback(a.src)}),this.container.appendChild(a)})}onSelect(e){this.selectCallback=e}getSelected(){return this.selected?.src||null}}class H{container;canvas;ctx;image=null;highlight=null;constructor(e){const t=document.getElementById(e);if(!t)throw new Error("Missing preview container");this.container=t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.imageRendering="pixelated",this.container.innerHTML="",this.container.appendChild(this.canvas)}showImage(e){this.image||(this.image=new Image),this.image.onload=()=>this.draw(),this.image.src=e}setHighlight(e){this.highlight=e,this.draw()}draw(){if(!this.image||!this.ctx)return;const e=this.canvas,t=this.ctx,a=200;if(e.width=a,e.height=a,t.clearRect(0,0,e.width,e.height),t.imageSmoothingEnabled=!1,t.drawImage(this.image,0,0,e.width,e.height),!this.highlight)return;const{x:i,y:n,w:o,h:m}=this.highlight,l=e.width/this.image.naturalWidth,d=e.height/this.image.naturalHeight,g=i%this.image.naturalWidth,A=n%this.image.naturalHeight,s=Math.min(o,this.image.naturalWidth-g),h=Math.min(m,this.image.naturalHeight-A);if(t.strokeStyle="blue",t.lineWidth=2,t.strokeRect(g*l,A*d,s*l,h*d),g+o>this.image.naturalWidth){const c=o-s;t.strokeRect(0,A*d,c*l,h*d)}if(A+m>this.image.naturalHeight){const c=m-h;t.strokeRect(g*l,0,s*l,c*d)}if(g+o>this.image.naturalWidth&&A+m>this.image.naturalHeight){const c=o-s,r=m-h;t.strokeRect(0,0,c*l,r*d)}}}class O{container;label;constructor(e,t){const a=document.getElementById(e);if(!a)throw new Error("Missing container");this.container=a;const i=document.getElementById(t);if(!i)throw new Error("Missing label");this.label=i}generate(e,t,a,i){const n=new Image;n.src=e;const o=[];return n.onload=()=>{const m=n.naturalWidth,l=n.naturalHeight,d=document.createElement("canvas");d.width=m,d.height=l;const g=d.getContext("2d");g.drawImage(n,0,0),this.container.innerHTML="";const A=new Set;let s=null;const h=8;for(let c=0;c<l;c++)for(let r=0;r<m;r++){const E=document.createElement("canvas");E.width=t,E.height=t;const y=E.getContext("2d");for(let f=0;f<t;f++)for(let x=0;x<t;x++){const L=(r+x)%m,U=(c+f)%l,D=g.getImageData(L,U,1,1);y.putImageData(D,x,f)}const w=y.getImageData(0,0,t,t);let v="";for(let f=0;f<w.data.length;f+=4)v+=`${w.data[f]},${w.data[f+1]},${w.data[f+2]},${w.data[f+3]};`;if(A.has(v))continue;A.add(v);const u=document.createElement("canvas");u.width=t*16,u.height=t*16;const I=u.getContext("2d");I.imageSmoothingEnabled=!1,I.drawImage(E,0,0,u.width,u.height),u.style.imageRendering="pixelated",u.style.border="1px solid #ccc",o.length%h===0&&(s=document.createElement("div"),s.style.display="flex",s.style.gap="4px",this.container.appendChild(s)),s.appendChild(u),o.push(u);const R=r,k=c;u.addEventListener("mouseenter",()=>a({x:R,y:k,w:t,h:t})),u.addEventListener("mouseleave",()=>i())}this.label.textContent=`Tiles: ${o.length}`},o}}class Q{tiles;neighbors;constructor(e){this.tiles=e,this.neighbors=this.computeNeighbors()}computeNeighbors(){const e=new Map,t=this.tiles[0].canvas.width;return this.tiles.forEach((a,i)=>{const n={up:[],down:[],left:[],right:[]};this.tiles.forEach((o,m)=>{if(i===m)return;let l=!0;for(let s=0;s<t;s++){const h=(s*t+(t-1))*4,c=s*t*4;for(let r=0;r<4;r++)if(a.data.data[h+r]!==o.data.data[c+r]){l=!1;break}if(!l)break}l&&n.right.push(o.id);let d=!0;for(let s=0;s<t;s++){const h=s*t*4,c=(s*t+(t-1))*4;for(let r=0;r<4;r++)if(a.data.data[h+r]!==o.data.data[c+r]){d=!1;break}d&&n.left.push(o.id)}let g=!0;for(let s=0;s<t;s++){const h=((t-1)*t+s)*4,c=s*4;for(let r=0;r<4;r++)if(a.data.data[h+r]!==o.data.data[c+r]){g=!1;break}if(!g)break}g&&n.down.push(o.id);let A=!0;for(let s=0;s<t;s++){const h=s*4,c=((t-1)*t+s)*4;for(let r=0;r<4;r++)if(a.data.data[h+r]!==o.data.data[c+r]){A=!1;break}A&&n.up.push(o.id)}}),e.set(a.id,n)}),e}}const W=Object.assign({"/samples/City.png":Y,"/samples/Flowers.png":P}),B=Object.values(W),C=new S("sample-selector",B),b=new H("sample-preview"),M=new O("generated-tiles","tiles-count");C.onSelect(p=>{b.showImage(p)});const X=document.getElementById("generate-tiles"),Z=document.getElementById("tile-size");X.addEventListener("click",()=>{const p=C.getSelected();if(!p)return;const e=parseInt(Z.value),a=M.generate(p,e,b.setHighlight.bind(b),()=>b.setHighlight(null)).map((n,o)=>({id:o,canvas:n,data:n.getContext("2d").getImageData(0,0,e,e)})),i=new Q(a);console.log(i)});
