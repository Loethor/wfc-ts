(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA1SURBVChTY/wPBAwEAFgRIyMjlIsJQGbAFb2VUYEKI4DwkztgRUxQPl5AZ0XE+w7KxwEYGABa5h/6Bw62agAAAABJRU5ErkJggg==",S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAYCAYAAAAlBadpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxEAAAsRAX9kX5EAAADkSURBVDhPnZTBEYJADEUDRw/WYgUOnrQDerEjO5ATjhVYhmcOXnGi+5m/2WR1eAdgE37yE2Zoxuc0y0radF+FK+422/Tkg3wh1kRzjQtw3p1ZE7fXlE4lyLu2tXIN5MOFHe6+bY5/xHa+cf+1bAvgjHzLC2DwgoXjrQ4+n6RY0N+2owWhC1zZcZaFcUV+tmNltvXCAQgRi8ZSsk9lhYDHYleLGAIrZGzxrLPClRnPVSZGwhaIXBWdvQKRm0KscAfPLnDFoCZUQjEEkVCpdv5FM5z78O953F1kePTpVFLtXBOKiLwB2Hltqu/4//UAAAAASUVORK5CYII=";class U{container;selected=null;selectCallback=null;constructor(t,e){const a=document.getElementById(t);if(!a)throw new Error("Missing container");this.container=a,this.createPreviews(e)}createPreviews(t){t.forEach(e=>{const a=document.createElement("img");a.src=e,a.style.imageRendering="pixelated",a.style.margin="5px",a.style.cursor="pointer",a.onload=()=>{const i=Math.floor(64/a.naturalWidth)||1;a.width=a.naturalWidth*i,a.height=a.naturalHeight*i},a.addEventListener("click",()=>{this.selected=a,this.container.querySelectorAll("img").forEach(s=>s.style.border=""),a.style.border="2px solid red",this.selectCallback&&this.selectCallback(a.src)}),this.container.appendChild(a)})}onSelect(t){this.selectCallback=t}getSelected(){return this.selected?.src||null}}class Y{container;canvas;ctx;image=null;highlight=null;constructor(t){const e=document.getElementById(t);if(!e)throw new Error("Missing preview container");this.container=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.imageRendering="pixelated",this.container.innerHTML="",this.container.appendChild(this.canvas)}showImage(t){this.image||(this.image=new Image),this.image.onload=()=>this.draw(),this.image.src=t}setHighlight(t){this.highlight=t,this.draw()}draw(){if(!this.image||!this.ctx)return;const t=this.canvas,e=this.ctx,a=200;if(t.width=a,t.height=a,e.clearRect(0,0,t.width,t.height),e.imageSmoothingEnabled=!1,e.drawImage(this.image,0,0,t.width,t.height),!this.highlight)return;const{x:s,y:i,w:r,h:c}=this.highlight,h=t.width/this.image.naturalWidth,g=t.height/this.image.naturalHeight,m=s%this.image.naturalWidth,A=i%this.image.naturalHeight,n=Math.min(r,this.image.naturalWidth-m),d=Math.min(c,this.image.naturalHeight-A);if(e.strokeStyle="blue",e.lineWidth=2,e.strokeRect(m*h,A*g,n*h,d*g),m+r>this.image.naturalWidth){const l=r-n;e.strokeRect(0,A*g,l*h,d*g)}if(A+c>this.image.naturalHeight){const l=c-d;e.strokeRect(m*h,0,n*h,l*g)}if(m+r>this.image.naturalWidth&&A+c>this.image.naturalHeight){const l=r-n,o=c-d;e.strokeRect(0,0,l*h,o*g)}}}class P{container;label;constructor(t,e){const a=document.getElementById(t);if(!a)throw new Error("Missing container");this.container=a;const s=document.getElementById(e);if(!s)throw new Error("Missing label");this.label=s}generate(t,e,a,s){const i=new Image;i.src=t;const r=[];return i.onload=()=>{const c=i.naturalWidth,h=i.naturalHeight,g=document.createElement("canvas");g.width=c,g.height=h;const m=g.getContext("2d");m.drawImage(i,0,0),this.container.innerHTML="";const A=new Set;let n=null;const d=8;for(let l=0;l<h;l++)for(let o=0;o<c;o++){const x=document.createElement("canvas");x.width=e,x.height=e;const b=x.getContext("2d");for(let p=0;p<e;p++)for(let v=0;v<e;v++){const R=(o+v)%c,D=(l+p)%h,k=m.getImageData(R,D,1,1);b.putImageData(k,v,p)}const w=b.getImageData(0,0,e,e);let E="";for(let p=0;p<w.data.length;p+=4)E+=`${w.data[p]},${w.data[p+1]},${w.data[p+2]},${w.data[p+3]};`;if(A.has(E))continue;A.add(E);const u=document.createElement("canvas");u.width=e*16,u.height=e*16;const y=u.getContext("2d");y.imageSmoothingEnabled=!1,y.drawImage(x,0,0,u.width,u.height),u.style.imageRendering="pixelated",u.style.border="1px solid #ccc",r.length%d===0&&(n=document.createElement("div"),n.style.display="flex",n.style.gap="4px",this.container.appendChild(n)),n.appendChild(u),r.push(u);const C=o,I=l;u.addEventListener("mouseenter",()=>a({x:C,y:I,w:e,h:e})),u.addEventListener("mouseleave",()=>s())}this.label.textContent=`Tiles: ${r.length}`},r}}class B{tiles;neighbors;constructor(t){this.tiles=t,this.neighbors=this.computeNeighbors()}computeNeighbors(){const t=new Map,e=this.tiles[0].canvas.width;return this.tiles.forEach((a,s)=>{const i={up:[],down:[],left:[],right:[]};this.tiles.forEach((r,c)=>{if(s===c)return;let h=!0;for(let n=0;n<e;n++){const d=(n*e+(e-1))*4,l=n*e*4;for(let o=0;o<4;o++)if(a.pixelData.data[d+o]!==r.pixelData.data[l+o]){h=!1;break}if(!h)break}h&&i.right.push(r.id);let g=!0;for(let n=0;n<e;n++){const d=n*e*4,l=(n*e+(e-1))*4;for(let o=0;o<4;o++)if(a.pixelData.data[d+o]!==r.pixelData.data[l+o]){g=!1;break}g&&i.left.push(r.id)}let m=!0;for(let n=0;n<e;n++){const d=((e-1)*e+n)*4,l=n*4;for(let o=0;o<4;o++)if(a.pixelData.data[d+o]!==r.pixelData.data[l+o]){m=!1;break}if(!m)break}m&&i.down.push(r.id);let A=!0;for(let n=0;n<e;n++){const d=n*4,l=((e-1)*e+n)*4;for(let o=0;o<4;o++)if(a.pixelData.data[d+o]!==r.pixelData.data[l+o]){A=!1;break}A&&i.up.push(r.id)}}),t.set(a.id,i)}),t}}class H{sampleList;previewCanvas;tileGenerator;tileSizeInput;generateBtn;constructor(t,e,a,s,i,r,c){this.sampleList=new U(t,c),this.previewCanvas=new Y(e),this.tileGenerator=new P(a,s),this.generateBtn=document.getElementById(i),this.tileSizeInput=document.getElementById(r),this.init()}init(){this.sampleList.onSelect(t=>this.previewCanvas.showImage(t)),this.generateBtn.addEventListener("click",()=>this.generateTiles())}generateTiles(){const t=this.sampleList.getSelected();if(!t)return;const e=parseInt(this.tileSizeInput.value),s=this.tileGenerator.generate(t,e,this.previewCanvas.setHighlight.bind(this.previewCanvas),()=>this.previewCanvas.setHighlight(null)).map((r,c)=>({id:c,canvas:r,pixelData:r.getContext("2d").getImageData(0,0,e,e)})),i=new B(s);console.log(i)}}const O=Object.assign({"/samples/City.png":L,"/samples/Flowers.png":S}),Q=Object.values(O);new H("sample-selector","sample-preview","generated-tiles","tiles-count","generate-tiles","tile-size",Q);
